<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>K√∂z√∂s Bev√°s√°rl√≥lista</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --card-bg: #1b2a1b;
      --muted: #aabfa8;
      --bg1: #071107;
      --bg2: #162016;
      --accent: #c3e6a5;
    }
    body {
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: #f3f8f0;
      font-family: system-ui, sans-serif;
      padding: 2rem 1rem;
    }
    .bg-card { background: var(--card-bg); }
    .item-exit {
      opacity: 0;
      transform: scale(0.95);
      max-height: 0 !important;
      padding: 0 !important;
      margin: 0 !important;
      border: none !important;
    }
    .toast {
      position: fixed;
      right: 16px;
      bottom: 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(6px);
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      transition: all .3s ease;
      opacity: 0;
      transform: translateY(10px);
      z-index: 60;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body class="flex flex-col items-center">

  <h1 class="text-3xl sm:text-4xl font-bold mb-6 text-center">üõí K√∂z√∂s Bev√°s√°rl√≥lista</h1>

  <div class="w-full max-w-md space-y-4">
    <details class="bg-card rounded-xl p-4" open>
      <summary class="font-semibold text-lg cursor-pointer mb-2">√öj t√©tel hozz√°ad√°sa</summary>
      <div class="space-y-3">
        <input id="name" type="text" placeholder="Term√©k neve" class="w-full p-3 rounded bg-neutral-800 border border-neutral-700" />
        <input id="quantity" type="text" placeholder="Mennyis√©g (pl. 2kg, 3db)" class="w-full p-3 rounded bg-neutral-800 border border-neutral-700" />
        <select id="person" class="w-full p-3 rounded bg-neutral-800 border border-neutral-700"></select>
        <textarea id="note" placeholder="Megjegyz√©s (opcion√°lis)" class="w-full p-3 rounded bg-neutral-800 border border-neutral-700"></textarea>
        <div class="flex gap-3">
          <button id="addBtn" class="w-full bg-lime-400 text-black font-semibold rounded p-3">Ment√©s</button>
          <button id="cancelBtn" class="w-full bg-gray-600 text-white font-semibold rounded p-3 hidden">M√©gse</button>
        </div>
      </div>
    </details>

    <details class="bg-card rounded-xl p-4">
      <summary class="font-semibold text-lg cursor-pointer mb-2">Keres√©s & Sz≈±r√©s</summary>
      <div class="space-y-3">
        <input id="search" type="text" placeholder="Keres√©s n√©v alapj√°n..." class="w-full p-3 rounded bg-neutral-800 border border-neutral-700" />
        <select id="filterPerson" class="w-full p-3 rounded bg-neutral-800 border border-neutral-700"></select>
      </div>
    </details>

    <ul id="list" class="space-y-3"></ul>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const API_KEY = "YOUR_JSONBIN_API_KEY"; // Replace with your actual API key
      const BIN_ID = "YOUR_BIN_ID"; // Replace with your actual Bin ID
      const BASE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

      let items = [];
      let editState = { isEditing: false, id: null };

      const getEl = (id) => document.getElementById(id);
      const list = getEl("list");
      const nameInput = getEl("name");
      const quantityInput = getEl("quantity");
      const personSelect = getEl("person");
      const noteInput = getEl("note");
      const addBtn = getEl("addBtn");
      const cancelBtn = getEl("cancelBtn");
      const searchInput = getEl("search");
      const filterPerson = getEl("filterPerson");

      const showToast = (msg) => {
        const t = document.createElement("div");
        t.className = "toast";
        t.textContent = msg;
        document.body.appendChild(t);
        requestAnimationFrame(() => t.classList.add("show"));
        setTimeout(() => {
          t.classList.remove("show");
          setTimeout(() => t.remove(), 300);
        }, 2000);
      };

      const updateRemote = async (data) => {
        try {
          await fetch(BASE_URL, {
            method: "PUT",
            headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
            body: JSON.stringify(data)
          });
          return true;
        } catch (err) {
          console.error(err);
          showToast("Hiba a ment√©s sor√°n!");
          return false;
        }
      };

      const fetchItems = async () => {
        try {
          const res = await fetch(`${BASE_URL}/latest`, { headers: { "X-Master-Key": API_KEY } });
          const data = await res.json();
          items = data.record || [];
          updateSelects();
          render();
        } catch (e) {
          showToast("Nem siker√ºlt bet√∂lteni az adatokat.");
        }
      };

      const render = () => {
        const q = (searchInput.value || "").toLowerCase();
        const selected = filterPerson.value;
        const filtered = items.filter(
          (i) =>
            (!q || (i.name || "").toLowerCase().includes(q)) &&
            (!selected || i.person === selected)
        );
        list.innerHTML = "";
        if (filtered.length === 0) {
          list.innerHTML = `<li class="text-center text-gray-400">Nincs tal√°lat.</li>`;
          return;
        }
        filtered.forEach((item) => {
          const li = document.createElement("li");
          li.className = "bg-card p-4 rounded flex flex-col gap-1 relative transition-all";
          li.dataset.id = item.id;
          li.innerHTML = `
            <div class="flex justify-between items-start">
              <div>
                <p class="font-semibold text-lg">${item.name}</p>
                ${item.quantity ? `<p class="text-sm text-gray-300">${item.quantity}</p>` : ""}
                ${item.person ? `<p class="text-sm text-gray-400"><i class="fa-solid fa-user mr-1"></i>${item.person}</p>` : ""}
                ${item.note ? `<p class="text-sm text-gray-400"><i class="fa-solid fa-comment mr-1"></i>${item.note}</p>` : ""}
              </div>
              <div class="flex flex-col gap-2 ml-3">
                <button class="text-lime-400 edit-btn"><i class="fa-solid fa-pen"></i></button>
                <button class="text-red-400 delete-btn"><i class="fa-solid fa-trash"></i></button>
              </div>
            </div>
          `;
          li.querySelector(".edit-btn").addEventListener("click", () => startEdit(item.id));
          li.querySelector(".delete-btn").addEventListener("click", () => removeItem(item.id));
          list.appendChild(li);
        });
      };

      const updateSelects = () => {
        const people = Array.from(new Set(items.map(i => i.person).filter(Boolean)));
        const defaultPeople = ["Vir√°g", "Samy"];
        const allPeople = Array.from(new Set([...defaultPeople, ...people]));
        personSelect.innerHTML = allPeople.map(p => `<option>${p}</option>`).join("");
        filterPerson.innerHTML = `<option value="">Mindenki</option>` + allPeople.map(p => `<option>${p}</option>`).join("");
      };

      const startEdit = (id) => {
        const item = items.find(i => i.id === id);
        if (!item) return;
        editState = { isEditing: true, id };
        nameInput.value = item.name;
        quantityInput.value = item.quantity;
        personSelect.value = item.person;
        noteInput.value = item.note;
        addBtn.textContent = "M√≥dos√≠t√°s ment√©se";
        cancelBtn.classList.remove("hidden");
      };

      const cancelEdit = () => {
        editState = { isEditing: false, id: null };
        nameInput.value = "";
        quantityInput.value = "";
        noteInput.value = "";
        addBtn.textContent = "Ment√©s";
        cancelBtn.classList.add("hidden");
      };

      const removeItem = async (id) => {
        if (!confirm("Biztosan t√∂rl√∂d?")) return;
        const old = [...items];
        items = items.filter(i => i.id !== id);
        const li = list.querySelector(`[data-id='${id}']`);
        if (li) {
          li.classList.add("item-exit");
          li.addEventListener("transitionend", () => li.remove(), { once: true });
        }
        if (!(await updateRemote(items))) {
          items = old;
          render();
        } else {
          showToast("T√∂r√∂lve");
          updateSelects();
        }
      };

      const handleAdd = async () => {
        const item = {
          id: editState.isEditing ? editState.id : Date.now(),
          name: nameInput.value.trim(),
          quantity: quantityInput.value.trim(),
          person: personSelect.value,
          note: noteInput.value.trim()
        };
        if (!item.name) return showToast("Add meg a term√©k nev√©t!");
        if (editState.isEditing) {
          const idx = items.findIndex(i => i.id === editState.id);
          if (idx !== -1) items[idx] = item;
          if (await updateRemote(items)) {
            showToast("Friss√≠tve");
            cancelEdit();
            render();
          }
        } else {
          const updated = [item, ...items];
          if (await updateRemote(updated)) {
            items = updated;
            showToast("Hozz√°adva");
            cancelEdit();
            updateSelects();
            render();
          }
        }
      };

      addBtn.addEventListener("click", handleAdd);
      cancelBtn.addEventListener("click", cancelEdit);
      searchInput.addEventListener("input", render);
      filterPerson.addEventListener("change", render);

      fetchItems();
    });
  </script>
</body>
</html>
