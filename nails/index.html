<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nail Color Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Color button hover and focus animations */
        .color-button {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .color-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Modal animations */
        .modal {
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            transition: transform 0.3s ease;
            transform: translateY(-20px);
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        /* Calendar day hover effect */
        .calendar-day {
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Button animations */
        .btn {
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Color applied animation */
        @keyframes colorApplied {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .color-applied {
            animation: colorApplied 0.4s ease;
        }

        /* View transition */
        .view-transition {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .view-enter {
            opacity: 0;
            transform: translateX(20px);
        }

        .view-enter-active {
            opacity: 1;
            transform: translateX(0);
        }

        /* Custom color animations */
        .custom-color {
            animation: fadeIn 0.3s ease;
        }

        .fade-out {
            animation: fadeOut 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }

            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        /* Success animation for add button */
        .success {
            background-color: #22c55e !important;
            /* green-500 */
        }

        /* Input focus styles */
        #custom-color-name:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto p-4">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Nail Color Tracker</h1>
            <p class="text-gray-600">Track your nail colors throughout the year</p>
        </header>

        <!-- View Controls -->
        <div class="flex justify-center items-center gap-4 mb-6">
            <!-- Calendar Views -->
            <div class="bg-gray-100 rounded-lg p-1 flex gap-1">
                <button class="view-btn px-4 py-2 rounded-md flex items-center gap-2 text-sm font-medium" data-view="month">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Month
                </button>
                <button class="view-btn px-4 py-2 rounded-md flex items-center gap-2 text-sm font-medium" data-view="year">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    Year
                </button>
            </div>

            <!-- Stats Button -->
            <button class="view-btn px-4 py-2 rounded-md flex items-center gap-2 text-sm font-medium bg-indigo-50 hover:bg-indigo-100 text-indigo-600 transition-colors duration-200" data-view="stats">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Statistics
            </button>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <!-- Dynamic content will be inserted here -->
        </div>

        <!-- Color Controls -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex flex-col gap-4">


                <!-- Custom color picker -->
                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">Custom Colors</h3>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2">
                            <input type="color" id="color-picker" class="w-12 h-12 rounded cursor-pointer">
                            <div class="flex flex-col gap-2">
                                <input type="text" id="custom-color-name" placeholder="Color name"
                                    class="px-3 py-1 border rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <button id="add-to-palette"
                                    class="px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm transition-all">
                                    Add to Palette
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Add a dedicated section for custom colors -->
                    <div id="custom-colors-grid" class="grid grid-cols-5 gap-4 sm:grid-cols-8 md:grid-cols-10 mt-4">
                        <!-- Custom colors will be added here -->
                    </div>
                </div>

                <!-- Action buttons -->
                <div class="flex gap-2 justify-end mt-2">
                    <button id="apply-color" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                        Apply Color
                    </button>
                    <button id="remove-color" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">
                        Remove Color
                    </button>
                </div>
            </div>
        </div>


    </div>

    <!-- Polish Modal -->
    <div id="polish-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">Add New Polish</h3>
            <form id="polish-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Brand</label>
                    <input type="text" id="polish-brand" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Name/Number</label>
                    <input type="text" id="polish-name" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Color</label>
                    <input type="color" id="polish-color" required
                        class="mt-1 block w-12 h-12 rounded cursor-pointer border-2 border-gray-200">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Finish</label>
                    <select id="polish-finish" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border">
                        <option value="cream">Cream</option>
                        <option value="shimmer">Shimmer</option>
                        <option value="glitter">Glitter</option>
                        <option value="metallic">Metallic</option>
                        <option value="matte">Matte</option>
                        <option value="pearl">Pearl</option>
                        <option value="holographic">Holographic</option>
                    </select>
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button type="button" id="cancel-polish-btn"
                        class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                    <button type="submit"
                        class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors">
                        Save Polish
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Core variables
        const mainContent = document.getElementById('main-content');
        const colorPicker = document.getElementById('color-picker');
        const colorName = document.getElementById('color-name');
        const applyColorBtn = document.getElementById('apply-color');
        const removeColorBtn = document.getElementById('remove-color');
        const viewButtons = document.querySelectorAll('.view-btn');
        const colorButtons = document.querySelectorAll('[data-color]');
        const customColorName = document.getElementById('custom-color-name');
        const addToPaletteBtn = document.getElementById('add-to-palette');
        let selectedColor = null;  // Add this line to track the selected color

        // State
        let currentView = 'month';
        let selectedDate = new Date();
        let colorData = loadColorData();
        let polishes = loadPolishCollection();
        let recentPolishes = loadRecentPolishes();
        let customColors = JSON.parse(localStorage.getItem('customColors') || '[]');

        // Initialize
        function init() {
            // Load polish collection first
            polishes = loadPolishCollection();
            console.log("Loaded polishes:", polishes); // Debug log
            renderPolishCollection();

            setActiveView('day');
            renderView();
            attachEventListeners();
        }

        // Event Listeners
        function attachEventListeners() {
            // View buttons
            viewButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    setActiveView(btn.dataset.view);
                    renderView();
                });
            });

            // Color controls
            applyColorBtn.addEventListener('click', () => {
                const color = colorPicker.value;
                const name = customColorName.value.trim() || '';
                if (color) {
                    addColor(selectedDate, color, name);
                }
            });

            removeColorBtn.addEventListener('click', () => {
                removeColor(selectedDate);
            });

            // Polish collection listeners
            const addPolishBtn = document.getElementById('add-polish-btn');
            const cancelPolishBtn = document.getElementById('cancel-polish-btn');
            const polishModal = document.getElementById('polish-modal');
            const polishForm = document.getElementById('polish-form');

            addPolishBtn?.addEventListener('click', () => {
                polishModal.classList.remove('hidden');
            });

            cancelPolishBtn?.addEventListener('click', () => {
                polishModal.classList.add('hidden');
                polishForm.reset();
            });

            polishForm?.addEventListener('submit', (e) => {
                e.preventDefault();
                const newPolish = {
                    brand: document.getElementById('polish-brand').value,
                    name: document.getElementById('polish-name').value,
                    color: document.getElementById('polish-color').value,
                    finish: document.getElementById('polish-finish').value
                };
                addPolish(newPolish);
                polishModal.classList.add('hidden');
                polishForm.reset();
            });

            polishModal?.addEventListener('click', (e) => {
                if (e.target === polishModal) {
                    polishModal.classList.add('hidden');
                    polishForm.reset();
                }
            });

            // Custom color picker
            document.querySelectorAll('[data-color]').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedColor = btn.dataset.color;
                    colorPicker.value = selectedColor;

                    // Remove selected state from all buttons
                    document.querySelectorAll('[data-color]').forEach(b =>
                        b.classList.remove('ring-2', 'ring-blue-500'));

                    // Add selected state to clicked button
                    btn.classList.add('ring-2', 'ring-blue-500');
                });
            });

            // Event listener for adding custom colors
            addToPaletteBtn.addEventListener('click', () => {
                const color = colorPicker.value;
                const name = customColorName.value.trim() || 'Custom Color';

                if (color) {
                    addCustomColor(color, name);
                    customColorName.value = ''; // Clear the input

                    // Add success animation
                    addToPaletteBtn.classList.add('success');
                    setTimeout(() => {
                        addToPaletteBtn.classList.remove('success');
                    }, 1000);
                }
            });
        }

        // View Management
        function setActiveView(view) {
            const mainContent = document.getElementById('main-content');
            mainContent.classList.add('view-transition', 'view-enter');

            setTimeout(() => {
                currentView = view;
                viewButtons.forEach(btn => {
                    const isActive = btn.dataset.view === view;
                    btn.classList.toggle('active', isActive);
                    
                    // Remove any lingering classes
                    btn.classList.remove('bg-blue-500', 'text-white', 'bg-gray-200', 'text-gray-700');
                });

                renderView();
                mainContent.classList.add('view-enter-active');
            }, 50);

            mainContent.addEventListener('transitionend', () => {
                mainContent.classList.remove('view-transition', 'view-enter', 'view-enter-active');
            }, { once: true });
        }

        // Data Management
        function loadColorData() {
            try {
                const saved = localStorage.getItem('nailColors');
                return saved ? JSON.parse(saved) : {};
            } catch (error) {
                console.error('Failed to load data:', error);
                return {};
            }
        }

        function saveColorData() {
            try {
                localStorage.setItem('nailColors', JSON.stringify(colorData));
            } catch (error) {
                console.error('Failed to save data:', error);
                alert('Failed to save changes');
            }
        }

        function addColor(date, color, name = '') {
            const dateKey = date.toISOString().split('T')[0];
            colorData[dateKey] = colorData[dateKey] || [];
            colorData[dateKey].push({
                color,
                name,
                timestamp: new Date().toISOString()
            });
            saveColorData();

            // Add animation to the day element
            const dayElement = document.querySelector(`[data-date="${dateKey}"]`);
            if (dayElement) {
                dayElement.classList.add('color-applied');
                dayElement.addEventListener('animationend', () => {
                    dayElement.classList.remove('color-applied');
                }, { once: true });
            }

            renderView();
        }

        function removeColor(date) {
            const dateKey = date.toISOString().split('T')[0];
            if (colorData[dateKey] && colorData[dateKey].length > 0) {
                colorData[dateKey].pop();
                if (colorData[dateKey].length === 0) {
                    delete colorData[dateKey];
                }
                saveColorData();
                renderView();
            }
        }

        function loadPolishCollection() {
            try {
                const saved = localStorage.getItem('polishCollection');
                if (!saved) {
                    // Default presets
                    const defaultPolishes = [
                        { brand: "OPI", name: "Alpine Snow", color: "#FFFFFF", finish: "cream" },
                        { brand: "Essie", name: "Ballet Slippers", color: "#FDE6E4", finish: "cream" },
                        { brand: "OPI", name: "Big Apple Red", color: "#DC1436", finish: "cream" },
                        { brand: "Essie", name: "Mint Candy Apple", color: "#98DFD6", finish: "cream" },
                        { brand: "OPI", name: "Lincoln Park After Dark", color: "#4A4A4A", finish: "cream" },
                        { brand: "Essie", name: "Bikini So Teeny", color: "#A7C7DC", finish: "shimmer" },
                        { brand: "OPI", name: "Bubble Bath", color: "#FBE6E6", finish: "cream" },
                        { brand: "Essie", name: "Wicked", color: "#2E0F15", finish: "cream" },
                        { brand: "OPI", name: "I'm Not Really a Waitress", color: "#C13828", finish: "metallic" },
                        { brand: "Essie", name: "Turquoise & Caicos", color: "#99DDC8", finish: "cream" },
                        { brand: "OPI", name: "You Don't Know Jacques", color: "#4A4238", finish: "cream" },
                        { brand: "Essie", name: "Chinchilly", color: "#999B9A", finish: "cream" }
                    ];
                    localStorage.setItem('polishCollection', JSON.stringify(defaultPolishes));
                    return defaultPolishes;
                }
                return JSON.parse(saved);
            } catch (error) {
                console.error('Failed to load polish collection:', error);
                return [];
            }
        }

        function renderPolishCollection() {
            const polishCollection = document.getElementById('polish-collection');
            if (!polishCollection) return;

            polishCollection.innerHTML = `
                ${recentPolishes.length > 0 ? `
                    <div class="col-span-full mb-4">
                        <h3 class="font-medium text-gray-700 mb-2">Recently Used</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            ${recentPolishes.map((polish, index) => renderPolishCard(polish, index, true)).join('')}
                        </div>
                    </div>
                    <div class="col-span-full border-t my-4"></div>
                ` : ''}
                <div class="col-span-full">
                    <h3 class="font-medium text-gray-700 mb-2">All Polishes</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        ${polishes.map((polish, index) => renderPolishCard(polish, index, false)).join('')}
                    </div>
                </div>
            `;
        }

        function renderPolishCard(polish, index, isRecent) {
            return `
                <div class="border rounded-lg p-4 flex flex-col gap-2">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full shadow" 
                            style="background-color: ${polish.color}"></div>
                        <div class="flex-1">
                            <div class="font-medium">${polish.brand}</div>
                            <div class="text-sm text-gray-600">${polish.name}</div>
                        </div>
                        ${!isRecent ? `
                            <button onclick="deletePolish(${index})" class="text-red-500 hover:text-red-600">×</button>
                        ` : ''}
                    </div>
                    <div class="text-sm text-gray-500 capitalize">${polish.finish}</div>
                    <button onclick="usePolish(${isRecent ? `'recent',` : ``}${index})" 
                        class="mt-2 w-full px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors text-sm">
                        Use This Polish
                    </button>
                </div>
            `;
        }

        function usePolish(source, index) {
            const polish = source === 'recent' ? recentPolishes[index] : polishes[index];
            colorPicker.value = polish.color;
            colorName.value = `${polish.brand} ${polish.name}`;
            addColor(selectedDate, polish.color, `${polish.brand} ${polish.name}`);
            addToRecents(polish);
        }

        function loadRecentPolishes() {
            try {
                const saved = localStorage.getItem('recentPolishes');
                return saved ? JSON.parse(saved) : [];
            } catch (error) {
                console.error('Failed to load recent polishes:', error);
                return [];
            }
        }

        function saveRecentPolishes() {
            try {
                localStorage.setItem('recentPolishes', JSON.stringify(recentPolishes));
            } catch (error) {
                console.error('Failed to save recent polishes:', error);
            }
        }

        function addToRecents(polish) {
            // Remove if already exists
            recentPolishes = recentPolishes.filter(p =>
                !(p.brand === polish.brand && p.name === polish.name)
            );
            // Add to front of array
            recentPolishes.unshift(polish);
            // Keep only last 5
            if (recentPolishes.length > 5) {
                recentPolishes.pop();
            }
            saveRecentPolishes();
            renderPolishCollection(); // Re-render to update the recents section
        }

        // Rendering
        function renderView() {
            mainContent.innerHTML = '';
            switch (currentView) {
                case 'month':
                    renderMonthView();
                    break;
                case 'year':
                    renderYearView();
                    break;
                default:
                    renderMonthView();
                    break;
            }
        }

        function renderMonthView() {
            const firstDay = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
            const lastDay = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0);
            const startPadding = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            const totalDays = lastDay.getDate();

            // Get today's date in Hungarian time zone
            const todayHungarian = new Date().toLocaleString('en-US', { timeZone: 'Europe/Budapest' });
            const todayKey = new Date(todayHungarian).toISOString().split('T')[0];

            const monthContent = `
                <div class="flex flex-col">
                    <h2 class="text-xl font-bold mb-4 text-center">
                        ${firstDay.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                    </h2>
                    <div class="grid grid-cols-7 gap-2">
                        ${['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day =>
                `<div class="text-center font-bold text-gray-600">${day}</div>`
            ).join('')}
                        ${Array(startPadding).fill().map(() =>
                `<div class="p-2"></div>`
            ).join('')}
                        ${Array(totalDays).fill().map((_, i) => {
                const date = new Date(Date.UTC(firstDay.getFullYear(), firstDay.getMonth(), i + 1));
                const dateKey = date.toISOString().split('T')[0];
                const colors = colorData[dateKey] || [];
                const isSelected = dateKey === selectedDate.toISOString().split('T')[0];
                const isToday = dateKey === todayKey;

                return `
                                <div class="p-2 border rounded-lg ${isSelected ? 'bg-blue-100 ring-2 ring-blue-500' : 'bg-white'} 
                                    ${isToday ? 'ring-2 ring-black-900' : ''} 
                                    cursor-pointer hover:bg-gray-50"
                                    onclick="selectDate('${dateKey}')">
                                    <div class="text-right text-sm mb-1">${i + 1}</div>
                                    <div class="flex flex-wrap gap-1">
                                        ${colors.map(entry => `
                                            <div class="w-4 h-4 rounded-full" 
                                                style="background-color: ${entry.color}"
                                                title="${entry.name || entry.color}">
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
            }).join('')}
                    </div>
                    <div class="flex justify-center gap-4 mt-4">
                        <button onclick="changeMonth(-1)" 
                            class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">
                            Previous Month
                        </button>
                        <button onclick="changeMonth(1)" 
                            class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">
                            Next Month
                        </button>
                    </div>
                </div>
            `;
            mainContent.innerHTML = monthContent;
        }

        function renderYearView() {
            const year = selectedDate.getFullYear();
            // Get today's date in Hungarian time zone
            const todayHungarian = new Date().toLocaleString('en-US', { timeZone: 'Europe/Budapest' });
            const todayKey = new Date(todayHungarian).toISOString().split('T')[0];

            const yearContent = `
                <div class="flex flex-col">
                    <div class="flex justify-center items-center gap-4 mb-4">
                        <button onclick="changeYear(-1)" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">Previous Year</button>
                        <h2 class="text-xl font-bold">${year}</h2>
                        <button onclick="changeYear(1)" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">Next Year</button>
                    </div>
                    <div class="grid grid-cols-1 gap-4">
                        ${Array(12).fill().map((_, month) => {
                const firstDay = new Date(year, month, 1);
                const monthName = firstDay.toLocaleDateString('en-US', { month: 'short' });
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Calculate the day of week offset (Monday = 0, Sunday = 6)
                const firstDayOfWeek = firstDay.getDay();
                const startPadding = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

                return `
                                <div class="border rounded-lg p-2">
                                    <div class="text-center font-bold mb-2">${monthName}</div>
                                    <div class="grid grid-cols-7 gap-px">
                                        ${['M', 'T', 'W', 'T', 'F', 'S', 'S'].map(day =>
                    `<div class="text-center text-xs font-bold text-gray-500">${day}</div>`
                ).join('')}
                                        ${Array(startPadding).fill().map(() =>
                    `<div class="aspect-square"></div>`
                ).join('')}
                                        ${Array(daysInMonth).fill().map((_, i) => {
                    const date = new Date(Date.UTC(year, month, i + 1));
                    const dateKey = date.toISOString().split('T')[0];
                    const colors = colorData[dateKey] || [];
                    const hasColor = colors.length > 0;
                    const isToday = dateKey === todayKey;
                    return `
                                                <div class="aspect-square text-center text-xs flex items-center justify-center 
                                                    ${isToday ? 'ring-1 ring-blue-500' : ''}"
                                                    style="${hasColor ? `background-color: ${colors[colors.length - 1].color}` : ''}"
                                                    title="${date.toLocaleDateString()}">
                                                    ${i + 1}
                                                </div>
                                            `;
                }).join('')}
                                    </div>
                                </div>
                            `;
            }).join('')}
                    </div>
                </div>
            `;
            mainContent.innerHTML = yearContent;
        }

        // Navigation
        function selectDate(dateString) {
            selectedDate = new Date(dateString);
            renderView();
        }

        function changeMonth(offset) {
            selectedDate.setMonth(selectedDate.getMonth() + offset);
            renderView();
        }

        function changeYear(offset) {
            selectedDate.setFullYear(selectedDate.getFullYear() + offset);
            renderView();
        }

        // Make navigation functions global
        window.selectDate = selectDate;
        window.changeMonth = changeMonth;
        window.changeYear = changeYear;
        window.usePolish = usePolish;

        // Initialize the app
        init();

        // Add animation class to color buttons
        document.querySelectorAll('[data-color]').forEach(button => {
            button.classList.add('color-button');
        });

        // Add animation class to modals
        const polishModal = document.getElementById('polish-modal');
        polishModal.classList.add('modal');
        polishModal.querySelector('.bg-white').classList.add('modal-content');

        // Add animation to calendar days
        document.querySelectorAll('.day').forEach(day => {
            day.classList.add('calendar-day');
        });

        // Add animation to buttons
        document.querySelectorAll('button').forEach(button => {
            if (!button.hasAttribute('data-color')) {
                button.classList.add('btn');
            }
        });

        // Function to save custom colors to localStorage
        function saveCustomColors() {
            localStorage.setItem('customColors', JSON.stringify(customColors));
        }

        // Function to add a custom color to the palette
        function addCustomColor(color, name) {
            // Create new color button container
            const colorContainer = document.createElement('div');
            colorContainer.className = 'flex flex-col items-center custom-color';

            // Create the color button
            const button = document.createElement('button');
            button.className = 'w-12 h-12 rounded-full shadow-md border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 color-button';
            button.style.backgroundColor = color;
            button.setAttribute('data-color', color);

            // Add click handler to use this color
            button.onclick = () => {
                colorPicker.value = color;
                colorName.value = name;
            };

            // Create the color name label
            const label = document.createElement('span');
            label.className = 'text-xs text-gray-600 mt-1 text-center';
            label.textContent = name;

            // Add delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'text-xs text-red-500 hover:text-red-700 mt-1';
            deleteBtn.textContent = 'Remove';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                colorContainer.classList.add('fade-out');
                setTimeout(() => {
                    colorContainer.remove();
                    customColors = customColors.filter(c => c.color !== color);
                    saveCustomColors();
                }, 300);
            };

            // Assemble the color container
            colorContainer.appendChild(button);
            colorContainer.appendChild(label);
            colorContainer.appendChild(deleteBtn);

            // Add to the custom colors grid
            const customColorsGrid = document.getElementById('custom-colors-grid');
            if (customColorsGrid) {
                customColorsGrid.appendChild(colorContainer);
            } else {
                console.error('Custom colors grid not found');
            }

            // Save to localStorage
            if (!customColors.some(c => c.color === color)) {
                customColors.push({ color, name });
                saveCustomColors();
            }
        }

        // Load saved custom colors on page load
        window.addEventListener('DOMContentLoaded', () => {
            customColors.forEach(color => {
                addCustomColor(color.color, color.name);
            });
        });
    </script>
</body>

</html>